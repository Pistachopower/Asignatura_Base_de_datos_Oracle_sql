-- ROWNUM
SELECT *
FROM EMP
WHERE ROWNUM <= 5;

SELECT *
FROM EMP
WHERE ROWNUM <= 3
ORDER BY 2 DESC;

-- SUPONIENDO QUE ES UNICO, OBTENER EL DEPARTAMENTO QUE TIENE MAS EMPLEADOS
SELECT MAX(COUNT(EMPNO))
FROM EMP E
GROUP BY DEPTNO;

SELECT D.DNAME, COUNT(E.EMPNO)
FROM EMP E,DEPT D
WHERE D.DEPTNO = E.DEPTNO 
GROUP BY D.DNAME
HAVING COUNT(E.EMPNO) = (SELECT MAX(COUNT(EMPNO))
                         FROM EMP E
                         GROUP BY DEPTNO);


SELECT * FROM EMP;

SELECT * FROM ( SELECT D.DNAME, COUNT(E.EMPNO) AS NUM_EMP
                FROM EMP E,DEPT D
                WHERE D.DEPTNO = E.DEPTNO 
                GROUP BY D.DNAME
                ORDER BY 2 DESC)
WHERE ROWNUM <=1;

-- ESTOY OBTENIENDO CONSULTA YA NO DE TABLAS SINO DE DATOS
SELECT * FROM (SELECT * FROM EMP);

SELECT * FROM (SELECT EMPNO AS NUM_EMPLE, ENAME AS NOMBRE, JOB AS TRABAJO FROM EMP);

SELECT * FROM (SELECT EMPNO AS NUM_EMPLE, ENAME AS NOMBRE, JOB AS TRABAJO FROM EMP)
WHERE UPPER(TRABAJO) = 'SALESMAN';

-- TENGO ESTE CONJUNTO DE DATOS
SELECT D.DNAME, D.LOC, E.*
FROM DEPT D, EMP E
WHERE D.DEPTNO  = E.DEPTNO;

--CREACION DE LAS VISTAS
CREATE VIEW V_DEPT_EMP(NOMDEPT, LUGAR, NUMEMP, NOMEMP, TRABAJO, CODIGOJEFE, FECHAALTA, SALARIO, COMISION, CODDEPT) 
 AS SELECT D.DNAME, D.LOC, E.EMPNO, E.ENAME,E.JOB, E.MGR,E.HIREDATE,E.SAL, E.COMM,E.DEPTNO
FROM DEPT D, EMP E
WHERE D.DEPTNO  = E.DEPTNO;


SELECT *
FROM V_DEPT_EMP;

-- 
SELECT *
FROM EMP E1, EMP E2
WHERE E1.MGR = E2.EMPNO;

SELECT * FROM EMP;


SELECT E2.ENAME AS NOMBREJEFE, E1.ENAME AS CURRITO
FROM EMP E1, EMP E2
WHERE E1.MGR = E2.EMPNO;

SELECT *
FROM DEPT;

SELECT * FROM EMP;
-- OUTER JOIN
SELECT *
FROM DEPT D, EMP E
WHERE D.DEPTNO = E.DEPTNO(+);

-- OUTER JOIN MODO ESTANDAR
SELECT *
FROM DEPT D LEFT JOIN EMP E ON D.DEPTNO =E.DEPTNO;

-- SI NO PONGO CONDICIONES SALEN TODOS LOS REGISTRO POR CADA TABLA, 
-- A ESTO SE LE CONOCE COMO PRODUCTO CARTESIANO
SELECT *
FROM DEPT D, EMP E
;


SELECT *
FROM EMPLEADOS;

SELECT * FROM CALENDARIO ORDER BY 1 DESC;


CREATE TABLE HORARIO_EMPLEADOS (
FECHA DATE,
CODEMP INTEGER,
NUMHORAS INTEGER,
NUMHORAS_REAL INTEGER);

ALTER TABLE HORARIO_EMPLEADOS ADD CONSTRAINTS HO_EM_PK PRIMARY KEY (FECHA, CODEMP);

INSERT INTO HORARIO_EMPLEADOS
SELECT FECHA,CODIGOEMPLEADO, 8,NULL
FROM EMPLEADOS, CALENDARIO
WHERE FECHA >= TO_DATE('01/01/2009','DD/MM/YYYY')
AND FECHA <= TO_DATE('31/12/2009','DD/MM/YYYY')
AND TO_CHAR(FECHA,'D') NOT IN ('6','7'); -- PARA COGER LOS DIAS LABORABLES.


--34