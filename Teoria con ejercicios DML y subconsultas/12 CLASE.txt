select ename, comm,count(comm), avg(comm), sum(comm)
from emp
group by ename,comm;

select count(comm), avg(comm), sum(comm), count(*), sum(comm)/count(comm), max(comm), min(comm)
from emp;

--45
select avg(sal)
from emp
where deptno in (10,20);

-- OBTENER LOS ALUMBNOS QUE ESTAN CON UNA DIFERENCIA MAXIMA DE EDAD DE 2 AÃ‘OS CON RESPECTO A LA MEDIA
SELECT * FROM ALUMNOS;

SELECT FECNAC FROM ALUMNOS;

/*
CALCULO LA MEDIA CON LA FUNCION AVG 
*/
--V_EDAD_MEDIA= 
SELECT AVG(EDAD)
FROM ALUMNOS;

/PREPARO LA CONSULTA GENERAL/
SELECT * 
FROM ALUMNOS
WHERE EDAD>= V_EDAD_MEDIA-2 
AND EDAD <= V_EDAD_MEDIA+2; 


/UNE LA CONSULTA FINAL/
SELECT * 
FROM ALUMNOS
WHERE EDAD>= (SELECT AVG(EDAD)
                FROM ALUMNOS)-2 
AND EDAD <= (SELECT AVG(EDAD)
FROM ALUMNOS)+2;


--- DELETE
ROLLBACK;
SELECT *
FROM EMP;


-- BORRA Y HAY UN COMMIT IMPLICITO
-- TRUNCATE TABLE EMP;

DELETE FROM EMP;

DELETE FROM EMP
WHERE UPPER(ENAME) = 'MILLER';

-- SOLO SE PUEDE BORRAR DE UNA TABLA
--BORRAR LOS EMPLEADOS CUYO NOMBRE DE DEPARTAMENTO CONTIENE LA LETRA I
SELECT DEPTNO
FROM DEPT
WHERE UPPER(DNAME) LIKE '%I%';

DELETE 
FROM EMP
WHERE DEPTNO IN (SELECT DEPTNO
                 FROM DEPT
                 WHERE UPPER(DNAME) LIKE '%I%')
                 ;

DELETE FROM  EMP
WHERE SAL >= 1500;



-- PRIMERO HAGO UNA CONSULTA Y LUEGO CAMBIO EL SELECT * POR EL DELETE

--SELECT *
DELETE
FROM EMP
WHERE COMM IS NULL;


-- BORRAR LOS DEPARTAMENTOS QUE NO TIENEN EMPLEADOS
-- 3 FORMAS DISTINTAS
DELETE -- SELECT 
FROM DEPT
WHERE IN (UNOS CODIGOS);

--1
SELECT DEPTNO
FROM DEPT
MINUS
SELECT DISTINCT DEPTNO
FROM EMP;

DELETE --SELECT *
FROM DEPT
WHERE DEPTNO IN (SELECT DEPTNO
          FROM DEPT
          MINUS
          SELECT DISTINCT DEPTNO
          FROM EMP);

--2
DELETE
FROM DEPT
WHERE DEPTNO NOT IN  (SELECT DISTINCT DEPTNO FROM EMP);

--3
SELECT DEPTNO
FROM DEPT D, EMP E
WHERE D.DEPTNO = E.DEPTNO(+)
AND E.EMPNO IS NULL;

DELETE
FROM DEPT
WHERE DEPTNO NOT IN (SELECT D.DEPTNO
                        FROM DEPT D, EMP E
                        WHERE D.DEPTNO = E.DEPTNO(+)
                        AND E.EMPNO IS NULL);