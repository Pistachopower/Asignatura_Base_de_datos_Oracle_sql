/******/
--LOS CLIENTES QUE NO HAN COMPRADO FRUTALES.
SELECT DISTINCT C.*
FROM CLIENTES C, PEDIDOS P,detallepedidos DP, productos PR
WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
AND DP.CODIGOPRODUCTO = PR.CODIGOPRODUCTO
AND UPPER(PR.GAMA) <> 'FRUTALES';


-- HACER CON EL ROWNUN
-- SABIENDO QUE ES UNICO OBTENER EL CLIENTES QUE HA PAGADO MÁS
--1. LO QUE HA GASTADO CADA CLIENTE
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE;

-- ORDENO POR LO GASTADO DESC
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
ORDER BY 2 DESC;

SELECT * FROM (SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
                FROM CLIENTES C, PAGOS PA
                WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
                GROUP BY C.NOMBRECLIENTE
                ORDER BY 2 DESC
               )
WHERE ROWNUM = 1;


-- LA FORMA NORMAL
SELECT MAX(SUM(PA.CANTIDAD))
FROM PAGOS PA
GROUP BY PA.CODIGOCLIENTE;

SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
HAVING SUM(PA.CANTIDAD) = (
                            SELECT MAX(SUM(PA.CANTIDAD))
                            FROM PAGOS PA
                            GROUP BY PA.CODIGOCLIENTE
                            );
                            
--- BY IRENE----------- MUY INTERE/******/
--LOS CLIENTES QUE NO HAN COMPRADO FRUTALES.
SELECT DISTINCT C.*
FROM CLIENTES C, PEDIDOS P,detallepedidos DP, productos PR
WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
AND DP.CODIGOPRODUCTO = PR.CODIGOPRODUCTO
AND UPPER(PR.GAMA) <> 'FRUTALES';


-- HACER CON EL ROWNUN
-- SABIENDO QUE ES UNICO OBTENER EL CLIENTES QUE HA PAGADO MÁS
--1. LO QUE HA GASTADO CADA CLIENTE
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE;

-- ORDENO POR LO GASTADO DESC
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
ORDER BY 2 DESC;

SELECT * FROM (SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
                FROM CLIENTES C, PAGOS PA
                WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
                GROUP BY C.NOMBRECLIENTE
                ORDER BY 2 DESC
               )
WHERE ROWNUM = 1;


-- LA FORMA NORMAL
SELECT MAX(SUM(PA.CANTIDAD))
FROM PAGOS PA
GROUP BY PA.CODIGOCLIENTE;

SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
HAVING SUM(PA.CANTIDAD) = (
                            SELECT MAX(SUM(PA.CANTIDAD))
                            FROM PAGOS PA
                            GROUP BY PA.CODIGOCLIENTE
                            );
                            
--- BY IRENE----------- MUY INTERESANE EN MODO ORACLE PURO
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
ORDER BY 2 DESC
FETCH FIRST 1 ROWS ONLY;


---
-- 69.Devuelve el nombre, apellido1 y cargo de los empleados que no representen a ningún cliente.
SELECT *
FROM EMPLEADOS 
WHERE CODIGOEMPLEADO NOT IN (SELECT CODIGOEMPLEADOREPVENTAS FROM CLIENTES);

-- CALCULAR EL SUELDO NETO, Y RETENCIOS IRPF MENSUAL, SABIENDO IRPF 19 SUELDO, 10 IRPF COMM
SELECT  ENAME, SAL + NVL(COMM,0) AS SUELDO_TOTAL, ROUND(SAL /1.19 + NVL(COMM,0)/1.10,2) AS SUELDONETO
FROM EMP;

--- ACTUALIZAR EN EMPLEADOS LA COMISION AL 15% DEL SUELO A AQUELLOS EMPLEADOS QUE DESCONOZCO SU COMISION
UPDATE EMP
SET COMM = SAL * 0.15
WHERE COMM IS NULL;

ROLLBACK;


-- EMPLEADOS QUE NO CONTIENE UNA A
SELECT ENAME
FROM EMP
WHERE UPPER(ENAME) NOT LIKE '%A%';SANE EN MODO ORACLE PURO
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE
ORDER BY 2 DESC
FETCH FIRST 1 ROWS ONLY;


---
-- 69.Devuelve el nombre, apellido1 y cargo de los empleados que no representen a ningún cliente.
SELECT *
FROM EMPLEADOS 
WHERE CODIGOEMPLEADO NOT IN (SELECT CODIGOEMPLEADOREPVENTAS FROM CLIENTES);

-- CALCULAR EL SUELDO NETO, Y RETENCIOS IRPF MENSUAL, SABIENDO IRPF 19 SUELDO, 10 IRPF COMM
SELECT  ENAME, SAL + NVL(COMM,0) AS SUELDO_TOTAL, ROUND(SAL /1.19 + NVL(COMM,0)/1.10,2) AS SUELDONETO
FROM EMP;

--- ACTUALIZAR EN EMPLEADOS LA COMISION AL 15% DEL SUELO A AQUELLOS EMPLEADOS QUE DESCONOZCO SU COMISION
UPDATE EMP
SET COMM = SAL * 0.15
WHERE COMM IS NULL;

ROLLBACK;


-- EMPLEADOS QUE NO CONTIENE UNA A
SELECT ENAME
FROM EMP
WHERE UPPER(ENAME) NOT LIKE '%A%';

