SELECT E.DEPTNO, SUM(E.SAL)
FROM EMP E
GROUP BY E.DEPTNO;

-- YO PUEDO AGRUPAR SIN TENER QUE MOSTRAR PORQUE AGRUPO
SELECT SUM(E.SAL)
FROM EMP E
GROUP BY E.DEPTNO;

-- CON ESTO RESPONDO A LA PREGUNTA DE CUAL ES EL GASTO MAYOR POR DEPARTAMENTO
SELECT MAX(SUM(E.SAL))
FROM EMP E
GROUP BY E.DEPTNO;

-- NO VALE LOS SIGUIENTE
SELECT E.DEPTNO, MAX(SUM(E.SAL))
FROM EMP E
GROUP BY E.DEPTNO;

-- MOSTRAR EL NOMBRE Y LOCALIZACION DEL DEPARTAMENTO QUE GASTA MAS EN SALARIOS
--CALCULO EN GASTO MAXIMO
--V_MAX_GASTO
SELECT MAX(SUM(E.SAL))
FROM EMP E
GROUP BY E.DEPTNO;


SELECT D.DNAME, D.LOC, SUM(E.SAL)
FROM DEPT D, EMP E
WHERE D.DEPTNO = E.DEPTNO
GROUP BY D.DNAME, D.LOC
HAVING SUM(E.SAL) = V_MAX_GASTO;


SELECT D.DNAME, D.LOC, SUM(E.SAL)
FROM DEPT D, EMP E
WHERE D.DEPTNO = E.DEPTNO
GROUP BY D.DNAME, D.LOC
HAVING SUM(E.SAL) = (SELECT MAX(SUM(E.SAL))
                     FROM EMP E
                     GROUP BY E.DEPTNO
                    ) ;

-- MOSTRAR LOS QUE GASTAN LOS DEPARTAMENTOSE GASTAN CERO.
--- QUIERO QUE SIEMPRE ME MUESTRE TODOS LOS DEPARTAMENTOS
SELECT D.DNAME, D.LOC, NVL(SUM(E.SAL),0)
FROM DEPT D, EMP E
WHERE D.DEPTNO = E.DEPTNO(+)
GROUP BY D.DNAME, D.LOC;


--- QUE PRODUCTOS HA COMPRADO CADA CLIENTE.
-- MOSTRAR EL NOMBRE DEL CLIENTE Y EL NOMBRE DEL PRODUCTO SIN REPETIR (DISTINCT BY RAUL)
SELECT DISTINCT c.nombrecliente, PR.NOMBRE
FROM CLIENTES C, PEDIDOS P, detallepedidos DP, PRODUCTOS PR
WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
AND DP.CODIGOPRODUCTO = PR.CODIGOPRODUCTO;


-- ULTIMO DIA DEL MES ACTUAL
SELECT LAST_DAY(SYSDATE)
FROM DUAL;

SELECT SYSDATE, ADD_MONTHS(SYSDATE,1), TO_CHAR(ADD_MONTHS(SYSDATE,1),'MM/YYYY') AS EXTRAER_MES_ANHO,
       '01/'||TO_CHAR(ADD_MONTHS(SYSDATE,1),'MM/YYYY'),
       TO_DATE('01/'||TO_CHAR(ADD_MONTHS(SYSDATE,1),'MM/YYYY'),'DD/MM/YYYY')AS PRIMER_DIA,
       TO_DATE('01/'||TO_CHAR(ADD_MONTHS(SYSDATE,1),'MM/YYYY'),'DD/MM/YYYY')-1
FROM DUAL;


-- TO_CHAR,TO_NUMBER; TO_DATE
-- EXTRACT TAMBIEN EXTRAE COSAS DE LA FECHA
-- '01/04/2000'--CADENA

SELECT TO_DATE('01/04/2000','DD/MM/YYYY'), SYSDATE,'08','8', 8, TO_NUMBER('08')
FROM DUAL;
/*

NOMBRE CCBB ..........IMPORTE(20)
NELSON 1521564        000000000001234
*/

-- 31
SELECT SYSDATE,TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI:SS')
FROM DUAL;  
      
-- 42
SELECT AVG(COMM), AVG(NVL(COMM,0)),COUNT(COMM),COUNT(NVL(COMM,0))
FROM EMP;

-- 50
SELECT ENAME, HIREDATE, TO_DATE('31/12/'||TO_CHAR(HIREDATE,'YYYY')),
       (TO_DATE('31/12/'||TO_CHAR(HIREDATE,'YYYY')) - HIREDATE)/7 AS SEMANAS_TRABAJADAS
FROM EMP;