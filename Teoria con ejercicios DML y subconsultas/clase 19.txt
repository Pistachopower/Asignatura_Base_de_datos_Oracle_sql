SELECT *
FROM CLIENTES C
WHERE C.CODIGOCLIENTE IN (SELECT CODIGOCLIENTE FROM PAGOS)
AND C.CODIGOCLIENTE NOT IN (SELECT CODIGOCLIENTE FROM PEDIDOS);

SELECT C.*
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE  = PA.CODIGOCLIENTE
MINUS
SELECT C.*
FROM CLIENTES C, PEDIDOS P
WHERE C.CODIGOCLIENTE  = P.CODIGOCLIENTE;

---
SELECT * 
FROM OFICINAS O
WHERE O.CODIGOOFICINA NOT IN (
            SELECT DISTINCT E.CODIGOOFICINA
            FROM  EMPLEADOS E, CLIENTES C, PEDIDOS P, 
                 DETALLEPEDIDOS DP, PRODUCTOS PR
            WHERE E.CODIGOEMPLEADO = C.CODIGOEMPLEADOREPVENTAS
            AND C.CODIGOCLIENTE = P.CODIGOCLIENTE
            AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
            AND DP.CODIGOPRODUCTO = PR.CODIGOPRODUCTO
            AND UPPER(PR.GAMA) = 'FRUTALES'
            );



-- 

/*
54. La facturación que ha tenido la empresa en toda la historia, 
   indicando la base imponible, el IVA y el total facturado.
    La base imponible se calcula sumando el coste del producto por el número de unidades vendidas de la tabla detalle pedido. 
    El IVA es el 21 % de la base imponible, y el total la suma de los dos campos anteriores.
*/
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD*DP.PRECIOUNIDAD) AS BASE_IMPONIBLE,
       SUM(DP.CANTIDAD*DP.PRECIOUNIDAD) * 0.21 AS IVA,
       SUM(DP.CANTIDAD*DP.PRECIOUNIDAD) * 1.21 AS TOTAL_FACTURADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE
AND DP.CODIGOPEDIDO = P.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE;
-- SI NO QUISIERA NO TODOS SINO AQUELLOS QUE HAN GASTADO 
-- MAS DE 10.000 ENTONCES UTILIZO EL HAVING
-- PUES LA CONDICIÓN AFECTA A LA FUNCION DE AGREGACIÓN
-- HAVING SUM(DP.CANTIDAD*DP.PRECIOUNIDAD) >= 10000;
SELECT *
FROM CLIENTES C
WHERE C.CODIGOCLIENTE NOT IN (SELECT CODIGOCLIENTE FROM PAGOS)
AND C.CODIGOCLIENTE NOT IN (SELECT CODIGOCLIENTE FROM PEDIDOS);


SELECT  NVL(SUM(PA.CANTIDAD),0),C.NOMBRECLIENTE
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE(+)
GROUP BY C.NOMBRECLIENTE;


SELECT  NVL(SUM(PA.CANTIDAD),0),C.NOMBRECLIENTE,C.CIUDAD
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE(+)
GROUP BY C.NOMBRECLIENTE,C.CIUDAD;


SELECT *
FROM CLIENTES C
WHERE C.CODIGOCLIENTE 
NOT IN (SELECT C.CODIGOCLIENTE FROM PAGOS PA, CLIENTES C
        WHERE  C.CODIGOCLIENTE = PA.CODIGOCLIENTE)
INTERSECT 
SELECT *
FROM CLIENTES C
WHERE C.CODIGOCLIENTE NOT IN (SELECT C.CODIGOCLIENTE FROM PEDIDOS P, CLIENTES C
                              WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE);
---

SELECT PA.CODIGOCLIENTE,SUM(PA.CANTIDAD)
FROM PAGOS PA
WHERE PA.CODIGOCLIENTE = 3
GROUP BY PA.CODIGOCLIENTE;

--
SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD), C.LIMITECREDITO
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
AND C.LIMITECREDITO > (SELECT SUM(PA.CANTIDAD)
                          FROM PAGOS PA
                          WHERE PA.CODIGOCLIENTE = C.CODIGOCLIENTE
                       )
GROUP BY C.NOMBRECLIENTE, C.LIMITECREDITO;
--                          

SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD), C.LIMITECREDITO
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.NOMBRECLIENTE, C.LIMITECREDITO
HAVING SUM(PA.CANTIDAD) <= C.LIMITECREDITO;

---
SELECT C.CODIGOCLIENTE, C.LIMITECREDITO, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY C.CODIGOCLIENTE, C.LIMITECREDITO
HAVING C.LIMITECREDITO > SUM(PA.CANTIDAD);

---
SELECT P.FECHAPEDIDO, TO_CHAR(FECHAPEDIDO, 'MM/YYYY')
FROM PEDIDOS P
--WHERE TO_CHAR(P.FECHAPEDIDO,'YYYY') = '2009';
WHERE TO_NUMBER(TO_CHAR(P.FECHAPEDIDO,'YYYY')) = 2009;

--WHERE P.FECHAPEDIDO >= TO_DATE('01/01/2009','DD/MM/YYYY') AND  P.FECHAPEDIDO <= TO_DATE('31/12/2009','DD/MM/YYYY');
--WHERE P.FECHAPEDIDO >= TO_DATE('03/15/2009','MM/DD/YYYY');
--WHERE P.FECHAPEDIDO >= TO_DATE('15/03/2009','DD/MM/YYYY');


-- PEDIDOS QUE HAN LLEGADO ENTRE 3 Y 5 DIAS
SELECT *
FROM PEDIDOS P
WHERE P.FECHAPEDIDO + 3 >= P.FECHAENTREGA
AND  P.FECHAPEDIDO + 5 <= P.FECHAENTREGA;
SELECT *
FROM PEDIDOS P
WHERE P.FECHAESPERADA >= P.FECHAENTREGA
-- EN EL CASO DE QUE TE DIGA QUE SI NO TIENE FECHA DE ENTREGA
-- REGISTRADA NO VAN A LLEGAR.
UNION
SELECT * 
FROM PEDIDOS P
WHERE P.FECHAENTREGA IS NULL
;


-- CHR
SELECT NOMBRECLIENTE, CHR(126), ASCII('~')
FROM CLIENTES;


--ROLL UP
SELECT C.PAIS,NVL(C.CIUDAD,'TOTAL PAIS'), SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
GROUP BY ROLLUP (C.PAIS,C.CIUDAD)
ORDER BY 1 ASC;




SELECT NOMBRECLIENTE, SUM(PAGADO), SUM(GASTADO)
FROM (           
            SELECT C.NOMBRECLIENTE, SUM(PA.CANTIDAD) AS PAGADO, 0 AS GASTADO
            FROM CLIENTES C, PAGOS PA
            WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
            GROUP BY C.NOMBRECLIENTE,0
            UNION 
            SELECT C.NOMBRECLIENTE, 0 AS PAGADO,SUM(DP.CANTIDAD*DP.PRECIOUNIDAD) AS GASTADO
            FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
            WHERE C.CODIGOCLIENTE = P.CODIGOCLIENTE
            AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
            GROUP BY C.NOMBRECLIENTE,0)
GROUP BY NOMBRECLIENTE;