-- OBTENER LA DESCRIPCIÓN TEXTUAL DE LAS GAMAS DE PRODUCTOS QUE HAN SIDO VENDIDOS POR EMPLEADOS QUE TIENE OFICINA EN BARCELONA

SELECT DISTINCT g.descripciontexto
FROM OFICINAS O, EMPLEADOS E, CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP, PRODUCTOS PR, GAMASPRODUCTOS G
WHERE O.CODIGOOFICINA = E.CODIGOOFICINA
AND E.CODIGOEMPLEADO = C.CODIGOEMPLEADOREPVENTAS
AND C.CODIGOCLIENTE = P.CODIGOCLIENTE
AND P.CODIGOPEDIDO =DP.CODIGOPEDIDO
AND DP.CODIGOPRODUCTO = PR.CODIGOPRODUCTO
AND PR.GAMA = G.GAMA
AND UPPER(O.CIUDAD) = 'BARCELONA';

-- MOSTRAR EL NOMBRE DEL CLIENTE Y CUANTO SE HA GASTADO
-- GASTO DE CADA CLIENTE
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE;

--MOSTRAR SOLO AQUELLOS QUE SE HAN GASTADO MAS DE 50000
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE
HAVING SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) >=1000;

-- DE TODOS LOS ANTERIORES SACAR EL QUE MAS SE HA GASTADO
-- SI EL VALOR MAYOR ES UNICO PUEDO UTILIZAR EL ROWNUM
SELECT *
FROM (  SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
        FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
        WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
        AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
        GROUP BY C.NOMBRECLIENTE
        HAVING SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) >=1000
        ORDER BY 2 DESC)
WHERE ROWNUM =1;

--PERO SI NO ES UNICO--- MEJOR FORMA--PUES LOS DATOS PUEDEN CAMBIAR.
VISTA---(NOMBRECLIENTE, SALARIO)
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE
HAVING SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) >=1000;

--QUE TIO ES EL QUE MAS COBRA
SELECT MAX(SALARIO) FROM VISTA;

SELECT *
FROM VISTA
WHERE SALARIO  = (SELECT MAX(SALARIO) FROM VISTA);

-- SUSTITUIMOS
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE
HAVING SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) = (SELECT MAX(SUM(DP.CANTIDAD *DP.PRECIOUNIDAD))
                                            FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
                                            WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
                                            AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
                                            GROUP BY C.NOMBRECLIENTE
                                            );

-- CUANTO HA PAGADO CADA CLIENTE MOSTRAR EL NOMBRE, LA CIUDAD Y LO QUE HA PAGADO, 
-- MOSTRAR SOLO LOS QUE HA PAGADO MAS DE 5000 Y QUE VIVAN EN BARCELONA, MADRID O GETAFE 
-- Y MUESTRALOS ORDENADOS POR NOMBRE DE CIUDAD ALFABETICAMENTE
SELECT C.NOMBRECLIENTE, C.CIUDAD, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE
AND UPPER(C.CIUDAD) IN ('BARCELONA','MADRID','GETAFE')
GROUP BY C.NOMBRECLIENTE, C.CIUDAD
HAVING SUM(PA.CANTIDAD) >= 5000
ORDER BY 2;



SELECT C.NOMBRECLIENTE, C.CIUDAD, SUM(PA.CANTIDAD)
FROM CLIENTES C, PAGOS PA
WHERE C.CODIGOCLIENTE = PA.CODIGOCLIENTE;

--DIME QUIENES SON LOS CLIENTES QUE VIVEN EN LA MISMA CIUDAD QUE GOLDFISH GARDEN
SELECT *
FROM CLIENTES
WHERE CLIENTES.CIUDAD =V_CIDUDAD_GFG;


-- QUE ES EL ROWNUM, NO ES MAS QUE MOSTRA UN CONTADOR DE FILAS QUE SALEN
SELECT C.NOMBRECLIENTE, C.CIUDAD
FROM CLIENTES C
WHERE UPPER(C.NOMBRECLIENTE) LIKE 'T%'
AND ROWNUM <=3;

SELECT * FROM (
SELECT C.NOMBRECLIENTE, SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) AS GASTADO
FROM CLIENTES C, PEDIDOS P, DETALLEPEDIDOS DP
WHERE C.CODIGOCLIENTE =P.CODIGOCLIENTE
AND P.CODIGOPEDIDO = DP.CODIGOPEDIDO
GROUP BY C.NOMBRECLIENTE
HAVING SUM(DP.CANTIDAD *DP.PRECIOUNIDAD) >=1000
ORDER BY 2 DESC
)
WHERE ROWNUM =1;
 
 -- RECORDEMOS EL DECODE
 SELECT E.ENAME, DECODE(E.SAL, 5000, 'SUPERSUELDO', 3000, 'PEDAZO SUELDO','OTRO SUELDO')
 FROM EMP E;
 
       
-- CATEGORIZAMOS EN BASE A SUELDO
-- SI COBRA MAS DE 3000--> SUELDO DE RICO
-- SI COBRA MÁS DE 2000 Y MENOS DE 3000-- SUELDO BUENO
-- SI COBRA ENTRE 1000 Y 2000 -- SUELDO MEDIO
-- MENOS DE MIL---SUELDO BASURA

SELECT E.ENAME, SAL,
        CASE
            --WHEN SAL >=10  THEN 'VENDO DROGA'
            WHEN SAL >=3000 AND UPPER(E.JOB) ='PRESIDENT' THEN 'QUE NO TE LO DIGO'
            WHEN SAL >=3000 THEN 'SUELDO DE RICO'
            WHEN SAL<3000 AND SAL>=2000 THEN 'SUELDO BUENO'
            WHEN SAL <2000 AND SAL >=1000 THEN 'SUELDO MEDIO'
            ELSE 'SUELDO BASURA'
         END AS TIPIFICACION_SUELDO
FROM EMP E;




